"use strict";

var db = require('db/db.js')
    , _ = require('underscore');

var documentRepository = {

    /**
     * @param document {Object}
     * @param callback {function(String, Object)}
     */
    save: function save(document, callback) {
        if (!document) {
            callback('Document is required', null);
        } else {
            db.update({
                documentType: document.documentType,
                key: document.key
            }, document, {upsert: true}, function (error, numReplaced, upsert) {
                callback(error, upsert);
            });
        }
    },

    /**
     * @param callback {function(String, Object[])}
     */
    findAll: function findAll(callback) {
        db.find({documentType: {$exists: true}}, callback);
    },

    /**
     * @param filter {Object}
     * @param callback {function(String, Object)}
     */
    getByFilter: function getByFilter(filter, callback) {
        db.find(filter, function (error, documents) {
            if (!documents || documents.length === 0) {
                callback(error, null);
            } else if (documents.length > 1) {
                callback(documents.length + ' documents found for filter', null);
            } else {
                callback(error, documents[0]);
            }
        });
    }

};

module.exports = documentRepository;
